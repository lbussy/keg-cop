<body class="d-flex flex-column h-100">

    <div class="loader" id="loader"></div>

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <a class="navbar-brand" href="/">
                <img src="mstile-150x150.png" style="width:25px;height:25px;">
                &nbsp;Keg Cop
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01"
                aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarColor01">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings/">Settings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/help/">Help</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about/">About</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main role="main" class="flex-shrink-0">

        <div class="container" id="indexApp" style="visibility:hidden;">
            <!-- Container -->

            <div class="page-header" id="banner">
                <h1><span id="breweryname" name="breweryname"></span></h1>
            </div>
            <div class="card border-dark mb-3">
                <!-- Sensor Readings -->
                <div class="card-header">
                    <h4 class="card-title">Tap List</h4>
                </div>
                <div class="card-body" id="tap0display">
                    <span id="tap0name" name="tap0name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap0prog" id="tap0prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap1display">
                    <span id="tap1name" name="tap1name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap1prog" id="tap1prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap2display">
                    <span id="tap2name" name="tap2name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap2prog" id="tap2prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap3display">
                    <span id="tap3name" name="tap3name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="ta30prog" id="tap3prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap4display">
                    <span id="tap4name" name="tap4name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap4prog" id="tap4prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap5display">
                    <span id="tap5name" name="tap0name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap5prog" id="tap5prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap6display">
                    <span id="tap6name" name="tap6name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap6prog" id="tap6prog">
                        </div>
                    </div>
                </div>
                <div class="card-body" id="tap7display">
                    <span id="tap7name" name="tap7name"></span>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 75%"
                            aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" name="tap7prog" id="tap7prog">
                        </div>
                    </div>
                </div>

            </div> <!-- Sensor Readings -->

        </div> <!-- Container -->

    </main>

    <footer class="footer mt-auto py-3">
        <div class="container">
            <span class="text-muted">Copyright Â© 2019-2020, Lee C. Bussy</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
        </script>

    <script>
        var loaded = 0; // Hold data load status
        // Attach the event after the page loads
        if (window.addEventListener)
            window.addEventListener("load", loadPage, false);
        else if (window.attachEvent)
            window.attachEvent("onload", loadPage);
        else window.onload = loadPage;

        function loadPage() {
            toggleLoader("on");
            populateFlow();
            populateConfig();
        }

        function populateFlow() { // Get flowmeter settings
            var url = "/flow/";
            var flow = $.getJSON(url, function () {
            })
                .done(function (flow) {
                    // http://kegcop.local/settings/#tap0

                    var numTaps = flow["tap"].length;
                    try {
                        for (var i = 0; i < numTaps; i++) {
                            $('span[name="tap' + i + 'name"]').html(flow.tap[i].name);
                            //         $('input[name="tap' + i + 'ppg"]').val(parseInt(flow.tap[i].ppg), 10);
                            //         $('input[name="tap' + i + 'beername"]').val(flow.tap[i].name);
                            //         $('input[name="tap' + i + 'cap"]').val(parseFloat(flow.tap[i].capacity));
                            //         $('input[name="tap' + i + 'remain"]').val(parseFloat(flow.tap[i].remaining));
                            //         $('input[name="tap' + i + 'active"]').prop("checked", flow.tap[i].active);
                        }
                    }
                    catch {
                        alert("Unable to parse configuration data from SPIFFS.");
                    }
                })
                .fail(function () {
                    alert("Unable to retrieve configuration data from SPIFFS.");
                })
                .always(function () {
                    // Can post-process here
                    loaded++;
                    if (loaded == 2) {
                        toggleLoader("off");
                    }
                });
        }

        function populateConfig() { // Get configuration settings
            var url = "/config/";
            var config = $.getJSON(url, function () {
            })
                .done(function (config) {
                    try {
                        // $('input[name="hostname"]').val(config.hostname);
                        $('span[name="breweryname"]').html(config.copconfig.breweryname);
                        // $('input[name="breweryname"]').val(config.copconfig.breweryname);
                        // $('input[name="kegeratorname"]').val(config.copconfig.kegeratorname);
                        // if (config.copconfig.imperial) {
                        //     $('input:radio[name="units"]')[1].checked = true;
                        // } else {
                        //     $('input:radio[name="units"]')[0].checked = true;
                        // }
                        // $('input[name="setpoint"]').val(parseFloat(config.temps.setpoint));
                        // $('select[name="controlpoint"] option[value=' + parseInt(config.temps.controlpoint, 10) + ']').attr('selected', 'selected');
                        // $('input[name="calroom"]').val(parseFloat(config.temps.roomcal));
                        // $('input[name="caltower"]').val(parseFloat(config.temps.towercal));
                        // $('input[name="calupper"]').val(parseFloat(config.temps.uppercal));
                        // $('input[name="callower"]').val(parseFloat(config.temps.lowercal));
                        // $('input[name="calkeg"]').val(parseFloat(config.temps.kegcal));
                        // $('input[name="targeturl"]').val(config.urltarget.url);
                        // $('input[name="targetfreq"]').val(parseInt(config.urltarget.freq, 10));
                        // $('select[name="cloudtype"] option[value=' + parseInt(config.cloud.type, 10) + ']').attr('selected', 'selected');
                        // $('input[name="cloudkey"]').val(config.cloud.key);
                        // $('input[name="cloudfreq"]').val(parseInt(config.cloud.freq), 10);
                    }
                    catch {
                        alert("Unable to parse configuration data from SPIFFS.");
                    }
                })
                .fail(function () {
                    alert("Unable to retrieve configuration data from SPIFFS.");
                })
                .always(function () {
                    // Can post-process here
                    loaded++;
                    if (loaded == 2) {
                        toggleLoader("off");
                    }
                });
        }
    </script>
</body>
</html>